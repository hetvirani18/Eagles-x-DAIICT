<!DOCTYPE html>
<html>
<head>
    <title>Test Dynamic API</title>
</head>
<body>
    <h1>Test Dynamic API Connection</h1>
    <button onclick="testAPI()">Test Different Locations</button>
    <div id="results"></div>

    <script>
        async function testAPI() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Testing API...</p>';
            
            const locations = [
                {name: 'Location 1', lat: 21.5720, lng: 73.1400},
                {name: 'Location 2', lat: 22.3080, lng: 69.6120},
                {name: 'Location 3', lat: 23.0440, lng: 70.6200}
            ];
            
            let html = '<h2>API Test Results:</h2>';
            
            for (const loc of locations) {
                try {
                    console.log(`Testing ${loc.name}: ${loc.lat}, ${loc.lng}`);
                    
                    const response = await fetch("http://localhost:8080/api/v1/advanced/comprehensive-analysis", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            latitude: loc.lat,
                            longitude: loc.lng,
                            technology_type: "pem",
                            electricity_source: "mixed_renewable",
                        }),
                    });
                    
                    const data = await response.json();
                    console.log(`${loc.name} response:`, data);
                    
                    if (data && data.summary) {
                        const s = data.summary;
                        html += `
                            <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                                <h3>${loc.name} (${loc.lat}, ${loc.lng})</h3>
                                <p><strong>Optimal Capacity:</strong> ${Number(s.optimal_capacity_kg_day).toLocaleString()} kg/day</p>
                                <p><strong>Annual Capacity:</strong> ${Number(s.annual_capacity_tonnes).toLocaleString()} tonnes/year</p>
                                <p><strong>LCOH (Base):</strong> ₹${Number(s.lcoh_base_per_kg).toFixed(2)}/kg</p>
                                <p><strong>ROI:</strong> ${Number(s.roi_percentage).toFixed(2)}%</p>
                                <p><strong>Total CAPEX:</strong> ₹${Number(s.total_investment_crores).toFixed(2)} Cr</p>
                                <p><strong>Payback:</strong> ${Number(s.payback_years).toFixed(2)} years</p>
                            </div>
                        `;
                    } else {
                        html += `<p><strong>${loc.name}:</strong> API Error or unexpected response shape</p>`;
                    }
                } catch (error) {
                    console.error(`Error testing ${loc.name}:`, error);
                    html += `<p><strong>${loc.name}:</strong> Error - ${error.message}</p>`;
                }
            }
            
            results.innerHTML = html;
        }
    </script>
</body>
</html>
